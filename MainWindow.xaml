<Window x:Class="FilKollen.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:FilKollen.Converters"
        Title="FilKollen Säkerhetsscanner"
        Height="800"
        Width="1200"
        MinHeight="600"
        MinWidth="900"
        WindowStartupLocation="CenterScreen"
        Style="{DynamicResource FK.Style.MainWindow}"
        Background="{DynamicResource FK.Brush.Bg}"
        Icon="Resources/Icons/filkollen.ico">

    <Window.Resources>
        <converters:WidthToColumnConverter x:Key="WidthToColumnConverter"/>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>

        <!-- Responsiv layoutmarkör via Tag="SingleColumn" -->
        <Style x:Key="ResponsiveGrid" TargetType="Grid">
            <Style.Triggers>
                <DataTrigger Binding="{Binding ActualWidth, RelativeSource={RelativeSource Self}, Converter={StaticResource WidthToColumnConverter}}" Value="True">
                    <Setter Property="Tag" Value="SingleColumn"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <!-- Custom Window Chrome -->
    <Border Background="{DynamicResource FK.Brush.Bg}" CornerRadius="12">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="72"/>   <!-- Header -->
                <RowDefinition Height="*"/>    <!-- Body -->
                <RowDefinition Height="Auto"/> <!-- Footer -->
            </Grid.RowDefinitions>

            <!-- === TOP BAR === -->
            <Border Grid.Row="0"
                    Background="{DynamicResource FK.Brush.Surface}"
                    CornerRadius="12,12,0,0"
                    BorderBrush="{DynamicResource FK.Brush.Border}"
                    BorderThickness="1,1,1,0">
                <Grid Margin="24,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Logo & Brand -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <Image Width="40" Height="40" Margin="0,0,16,0"
                            Source="pack://application:,,,/Resources/Icons/filkollen.png"
                               Stretch="Uniform" SnapsToDevicePixels="True"/>
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="FILKOLLEN" FontSize="18" FontWeight="Black"
                                       Foreground="{DynamicResource FK.Brush.Text}"/>
                            <TextBlock Text="Anti-bluff och hackare" FontSize="11" FontWeight="Medium"
                                       Foreground="{DynamicResource FK.Brush.Primary}" Margin="0,-2,0,0"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Status Chip -->
                    <Border Grid.Column="1" HorizontalAlignment="Center" VerticalAlignment="Center"
                            Background="{DynamicResource FK.Brush.CardGradient}"
                            BorderBrush="{DynamicResource FK.Brush.Border}" BorderThickness="1"
                            CornerRadius="20" Padding="16,8">
                        <StackPanel Orientation="Horizontal">
                            <Ellipse x:Name="StatusIndicator" Width="10" Height="10"
                                     Fill="{DynamicResource FK.Brush.Danger}" Margin="0,0,8,0"/>
                            <TextBlock x:Name="SystemStatusText" Text="SKYDD INAKTIVERAT"
                                       FontWeight="SemiBold" FontSize="13"
                                       Foreground="{DynamicResource FK.Brush.Text}"/>
                        </StackPanel>
                    </Border>

                    <!-- Theme Selector -->
                    <ComboBox Grid.Column="2" x:Name="ThemeSelector" Width="140" Height="40" Margin="0,0,20,0"
                              Style="{DynamicResource FK.Style.ThemeToggle}"
                              SelectionChanged="ThemeSelector_SelectionChanged">
                        <ComboBoxItem Content="🖥️ System"/>
                        <ComboBoxItem Content="☀️ Ljust"/>
                        <ComboBoxItem Content="🌙 Mörkt"/>
                    </ComboBox>

                    <!-- Window Controls -->
                    <StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Center">
                        <Button Content="−" Width="32" Height="32" Style="{DynamicResource FK.Style.GlassButton}"
                                FontSize="16" Margin="4,0" Click="MinimizeButton_Click" ToolTip="Minimera"/>
                        <Button Content="✕" Width="32" Height="32" Style="{DynamicResource FK.Style.GlassButton}"
                                FontSize="14" Click="CloseButton_Click" ToolTip="Stäng"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- === MAIN BODY === -->
            <Grid Grid.Row="1" Margin="20" Style="{StaticResource ResponsiveGrid}">
                <!-- Rader för 1-kolumnsläget -->
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>  <!-- vänsterkort överst -->
                    <RowDefinition Height="20"/>    <!-- spacer -->
                    <RowDefinition Height="*"/>     <!-- högerhuvud -->
                </Grid.RowDefinitions>

                <!-- Kolumner för brett läge -->
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="320" MinWidth="280" MaxWidth="320"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- LEFT PANEL -->
                <ScrollViewer Grid.Column="0" Grid.Row="0" Grid.ColumnSpan="1"
                              VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                    <ScrollViewer.Style>
                        <Style TargetType="ScrollViewer">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Tag, RelativeSource={RelativeSource AncestorType=Grid}}" Value="SingleColumn">
                                    <Setter Property="Grid.Column" Value="0"/>
                                    <Setter Property="Grid.ColumnSpan" Value="3"/>
                                    <Setter Property="Grid.Row" Value="0"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </ScrollViewer.Style>

                    <StackPanel>
                        <!-- Real-time Protection Card -->
                        <Border Style="{DynamicResource FK.Style.GlassCard}" Margin="0,0,0,20">
                            <StackPanel>
                                <TextBlock Text="🛡️ REALTIDSSKYDD" FontSize="16" FontWeight="SemiBold"
                                           Foreground="{DynamicResource FK.Brush.Text}" HorizontalAlignment="Center"
                                           Margin="0,0,0,20"/>
                                <ToggleButton x:Name="ProtectionToggle"
                                              Style="{DynamicResource FK.Style.ProtectionToggle}"
                                              HorizontalAlignment="Center" Margin="0,0,0,16"
                                              Checked="ProtectionToggle_Checked"
                                              Unchecked="ProtectionToggle_Unchecked"/>
                                <Border x:Name="ProtectionStatusBadge" Background="{DynamicResource FK.Brush.Danger}"
                                        CornerRadius="12" Padding="12,8" HorizontalAlignment="Center" Opacity="0.9">
                                    <StackPanel Orientation="Horizontal">
                                        <Ellipse Width="6" Height="6" Fill="White" Margin="0,0,6,0"/>
                                        <TextBlock x:Name="ProtectionStatusText" Text="SYSTEMET ÄR SÅRBART"
                                                   Foreground="White" FontSize="11" FontWeight="SemiBold"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Border>

                        <!-- Quick Actions Card -->
                        <Border Style="{DynamicResource FK.Style.GlassCard}" Margin="0,0,0,20">
                            <StackPanel>
                                <TextBlock Text="⚡ SNABBÅTGÄRDER" FontSize="16" FontWeight="SemiBold"
                                           Foreground="{DynamicResource FK.Brush.Text}" HorizontalAlignment="Center"
                                           Margin="0,0,0,20"/>
                                <Button x:Name="TempScanButton" Content="🔍 Skanna suspekta-filer"
                                        Style="{DynamicResource FK.Style.GlassButton}" Margin="0,0,0,12"
                                        Click="TempScanButton_Click"/>
                                <Button x:Name="BrowserCleanButton" Content="🌐 Rensa bluffnotiser"
                                        Style="{DynamicResource FK.Style.GlassButton}" Margin="0,0,0,12"
                                        Click="BrowserCleanButton_Click"/>
                                <Button x:Name="SystemInfoButton" Content="ℹ️ Systeminformation"
                                        Style="{DynamicResource FK.Style.GlassButton}"
                                        Click="SystemInfoButton_Click"/>
                            </StackPanel>
                        </Border>

                        <!-- Statistics Card -->
                        <Border Style="{DynamicResource FK.Style.GlassCard}">
                            <StackPanel>
                                <TextBlock Text="📊 STATISTIK" FontSize="16" FontWeight="SemiBold"
                                           Foreground="{DynamicResource FK.Brush.Text}" HorizontalAlignment="Center"
                                           Margin="0,0,0,20"/>

                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Suspekta filer:"
                                               Foreground="{DynamicResource FK.Brush.Subtext}" FontSize="13"/>
                                    <TextBlock Grid.Row="0" Grid.Column="1" x:Name="StatsThreatsFound" Text="0"
                                               FontSize="18" FontWeight="Bold"
                                               Foreground="{DynamicResource FK.Brush.Danger}"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Skannade filer:"
                                               Foreground="{DynamicResource FK.Brush.Subtext}" FontSize="13" Margin="0,12,0,0"/>
                                    <TextBlock Grid.Row="1" Grid.Column="1" x:Name="StatsFilesScanned" Text="0"
                                               FontSize="18" FontWeight="Bold"
                                               Foreground="{DynamicResource FK.Brush.Primary}" Margin="0,12,0,0"/>

                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Senaste skanning:"
                                               Foreground="{DynamicResource FK.Brush.Subtext}" FontSize="13" Margin="0,12,0,0"/>
                                    <TextBlock Grid.Row="2" Grid.Column="1" x:Name="StatsLastScan" Text="Aldrig"
                                               FontSize="13" FontWeight="SemiBold"
                                               Foreground="{DynamicResource FK.Brush.Subtext}" Margin="0,12,0,0"/>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>

                <!-- RIGHT MAIN AREA -->
                <Grid Grid.Column="2" Grid.Row="0" Grid.ColumnSpan="1">
                    <Grid.Style>
                        <Style TargetType="Grid">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Tag, RelativeSource={RelativeSource AncestorType=Grid}}" Value="SingleColumn">
                                    <Setter Property="Grid.Column" Value="0"/>
                                    <Setter Property="Grid.ColumnSpan" Value="3"/>
                                    <Setter Property="Grid.Row" Value="2"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Style>

                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <Grid Grid.Row="0" Margin="0,0,0,20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="🚨 SÄKERHETSSTATUS"
                                   FontSize="20" FontWeight="Bold"
                                   Foreground="{DynamicResource FK.Brush.Text}"/>

                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <Button Content="🔄 Uppdatera" Style="{DynamicResource FK.Style.GlassButton}"
                                    Margin="0,0,12,0" Click="RefreshThreatsButton_Click"/>
                            <Button Content="🧹 Rensa alla" Style="{DynamicResource FK.Style.GlassButton}"
                                    Click="HandleAllThreatsButton_Click"/>
                        </StackPanel>
                    </Grid>

                    <!-- Summary Stats Cards -->
                    <UniformGrid Grid.Row="1" Columns="2" Margin="0,0,0,20">
                        <Border Style="{DynamicResource FK.Style.GlassCard}" Margin="0,0,10,0"
                                BorderBrush="{DynamicResource FK.Brush.Danger}">
                            <StackPanel HorizontalAlignment="Center">
                                <Border Width="60" Height="60" CornerRadius="30"
                                        Background="{DynamicResource FK.Brush.Danger}"
                                        HorizontalAlignment="Center" Margin="0,0,0,12">
                                    <TextBlock Text="⚠️" FontSize="28" Foreground="White"
                                               HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Text="SUSPEKTA FILER" FontSize="12" FontWeight="SemiBold"
                                           Foreground="{DynamicResource FK.Brush.Text}" HorizontalAlignment="Center"
                                           Margin="0,0,0,4"/>
                                <TextBlock x:Name="SuspiciousFilesCount" Text="0" FontSize="32" FontWeight="Black"
                                           Foreground="{DynamicResource FK.Brush.Danger}" HorizontalAlignment="Center"/>
                                <TextBlock Text="kräver omedelbar åtgärd" FontSize="10" HorizontalAlignment="Center"
                                           Foreground="{DynamicResource FK.Brush.Subtext}" TextAlignment="Center"/>
                            </StackPanel>
                        </Border>

                        <Border Style="{DynamicResource FK.Style.GlassCard}" Margin="10,0,0,0"
                                BorderBrush="{DynamicResource FK.Brush.Success}">
                            <StackPanel HorizontalAlignment="Center">
                                <Border Width="60" Height="60" CornerRadius="30"
                                        Background="{DynamicResource FK.Brush.Success}"
                                        HorizontalAlignment="Center" Margin="0,0,0,12">
                                    <TextBlock Text="🔍" FontSize="28" Foreground="White"
                                               HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Text="SKANNADE FILER" FontSize="12" FontWeight="SemiBold"
                                           Foreground="{DynamicResource FK.Brush.Text}" HorizontalAlignment="Center"
                                           Margin="0,0,0,4"/>
                                <TextBlock x:Name="FilesScannedCount" Text="0" FontSize="32" FontWeight="Black"
                                           Foreground="{DynamicResource FK.Brush.Success}" HorizontalAlignment="Center"/>
                                <TextBlock Text="analyserade denna session" FontSize="10" HorizontalAlignment="Center"
                                           Foreground="{DynamicResource FK.Brush.Subtext}" TextAlignment="Center"/>
                            </StackPanel>
                        </Border>
                    </UniformGrid>

                    <!-- Main Status Area -->
                    <Border Grid.Row="2" Style="{DynamicResource FK.Style.GlassCard}">
                        <Grid>
                            <StackPanel x:Name="NoThreatsPanel" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="Visible">
                                <Border Width="100" Height="100" CornerRadius="50"
                                        Background="{DynamicResource FK.Brush.Success}"
                                        HorizontalAlignment="Center" Margin="0,0,0,24">
                                    <TextBlock Text="✓" FontSize="50" Foreground="White"
                                               HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Text="🎉 INGA AKTIVA HOT UPPTÄCKTA!"
                                           FontSize="24" FontWeight="Bold" HorizontalAlignment="Center"
                                           Foreground="{DynamicResource FK.Brush.Success}" Margin="0,0,0,12"/>
                                <TextBlock Text="Ditt system är säkert. Håll realtidsskyddet aktiverat för maximal säkerhet."
                                           FontSize="14" TextAlignment="Center" Foreground="{DynamicResource FK.Brush.Subtext}"
                                           TextWrapping="Wrap" MaxWidth="400" LineHeight="20"/>
                            </StackPanel>

                            <ScrollViewer x:Name="ThreatsPanel" Visibility="Collapsed" VerticalScrollBarVisibility="Auto">
                                <StackPanel x:Name="ThreatsListPanel"/>
                            </ScrollViewer>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>

            <!-- === FOOTER === -->
            <Border Grid.Row="2"
                    VerticalAlignment="Bottom"
                    Background="{DynamicResource FK.Brush.Surface}"
                    CornerRadius="0,0,12,12"
                    BorderBrush="{DynamicResource FK.Brush.Border}"
                    BorderThickness="1,0,1,1"
                    Height="50" Margin="0,0,0,0">
                <Grid Margin="24,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock x:Name="StatusBarText" Grid.Column="0"
                               Text="Välkommen till FilKollen Säkerhetsscanner - Aktivera realtidsskydd för fullständig säkerhet"
                               Foreground="{DynamicResource FK.Brush.Subtext}" VerticalAlignment="Center" FontSize="12"/>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="20,0">
                        <TextBlock Text="🔑" FontSize="14" Margin="0,0,6,0"/>
                        <TextBlock x:Name="LicenseStatusText" Text="TRIAL AKTIVT" FontSize="11"
                                   Foreground="{DynamicResource FK.Brush.Primary}" FontWeight="Medium"/>
                    </StackPanel>

                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                        <Ellipse Width="6" Height="6" Fill="{DynamicResource FK.Brush.Success}" Margin="0,0,6,0"/>
                        <TextBlock x:Name="ConnectionStatusText" Text="ONLINE" FontSize="11"
                                   Foreground="{DynamicResource FK.Brush.Success}" FontWeight="Bold"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>  <!-- outer grid -->
    </Border>    <!-- outer border -->
</Window>
